var the_data,targeturl,fromfilter,globallimit,globalform,field_data;function initiation(a){targeturl=a,$.ajax({type:"ajax",url:targeturl+"/list",async:!0,dataType:"json",success:function(a){from_filter(!1),get_data(a)}})}function from_filter(a){fromfilter=a}function set_filter_title(){if(1==fromfilter){var a="",t=0,e=[];for(i=0;i<the_data.data.filters.length;i++)if(""!=the_data.data.filters[i].value&&null!=the_data.data.filters[i].value){if("select"==the_data.data.filters[i].type)for(var l=0;l<the_data.data.filters[i].options.length;l++)the_data.data.filters[i].options[l].value==the_data.data.filters[i].value&&e.push('<span class="text-body">'+the_data.data.filters[i].label+' : </span><span class=".text-secondary">'+the_data.data.filters[i].options[l].label+"</span>");else e.push('<span class="text-body">'+the_data.data.filters[i].label+' : </span><span class=".text-secondary">'+the_data.data.filters[i].value+"</span>");t++}a+=1<t?'<span class="text-dark">'+t+' Filters <i class="fa fa-caret-right"></i></span> ':'<span class="text-dark">A Filter <i class="fa fa-caret-right"></i></span> ',a+=""+e.join(", "),$(".title-information").html(a)}else{a="";$(".title-information").html(a)}}function set_pagination(){if(null!=the_data.data.pagination){var a=the_data.data.pagination[0];globallimit=a;var t=the_data.data.pagination[1],e=the_data.data.pagination[2],l=Math.ceil(e/a);html='<nav aria-label="pagination-example">',html+='<ul class="pagination justify-content-center">',html+="0"==t?'<li class="page-item disabled"><a href="javascript:void(0)" numb="" class="page-link">Prev</a></li>':'<li class="page-item"><a href="javascript:void(0)" numb="'+t/a+'" class="page-link">Prev</a></li>';for(var d=0;d<l;d++)html+=t/a==d?'<li class="page-item active"><a href="javascript:void(0)" numb="'+(d+1)+'" class="page-link">'+(d+1)+"</a></li>":'<li class="page-item"><a href="javascript:void(0)" numb="'+(d+1)+'" class="page-link">'+(d+1)+"</a></li>";html+=e-t<=a?'<li class="page-item disabled"><a class="page-link">Next</a></li>':'<li class="page-item"><a href="javascript:void(0)" numb ="'+(t/a+2)+'" class="page-link">Next</a></li>',html+="</ul>",html+="</nav>",$(".paging").html(html)}}function get_data(a){if(console.log("from filter : "+fromfilter),"table_default"==(the_data=a).type)hide_toolbar(),$("#show-data").html(generate_table()),null!=the_data.data.filters&&$(".modal-filter .filter-body").html(generate_form(!0)),set_pagination(),set_filter_title(),set_daterange();else if("insert_default"==a.type)$("#modal-add .modal-body").html(generate_form(!1)),$("#modal-add").modal("show");else if("update_default"==a.type)$("#modal-edit .modal-body").html(generate_form(!1)),$("#modal-edit").modal("show");else if("detail_default"==a.type)$("#modal-detail .modal-body").html(generate_table()),$("#modal-detail").modal("show");else if("error"==a.type){var t="<ul>";for(e=0;e<the_data.data.info.length;e++)t+="<li>",t+=the_data.data.info[e],t+="</li>";t+="</ul>",$("#modal-info .modal-title").html("Information : ERROR"),$("#modal-info .modal-body").html('<div class="alert alert-light" role="alert">'+t+"</div>"),$("#modal-info").modal("show"),set_filter_title()}else if("success"==a.type){var e;t="<ul>";for(e=0;e<the_data.data.info.length;e++)t+="<li>",t+=the_data.data.info[e],t+="</li>";t+="</ul>",$("#modal-info .modal-title").html("Information : Success"),$("#modal-info .modal-body").html('<div class="alert alert-light" role="alert">'+t+"</div>"),$("#modal-info").modal("show"),set_filter_title()}else if("modal_form"==a.type){$(".for_modal").html(generate_modal());var l='<input role="button" type="reset" id="button-reset" name="reset" class="btn btn-info" value="reset">';l+='<input role="button" type="submit" id="button-submit" name="submit" class="btn btn-primary" value="submit" style="margin-left: 30px;">',$("#"+the_data.data.id+" .modal-footer").html(l),$("#"+the_data.data.id+" .modal-body").html(generate_form(!1)),$("#"+the_data.data.id).modal("show"),onclik_submit()}else if("modal_table"==a.type){$(".for_modal").html(generate_modal()),$("#"+the_data.data.id+" .modal-body").html(generate_table());l='<button type="button" class="mr-auto btn btn-secondary" data-dismiss="modal">Close</button>';$("#"+the_data.data.id+" .modal-footer").html(l),$("#"+the_data.data.id).modal("show")}}function set_daterange(){for(i=0;i<field_data.length;i++)"daterange"==field_data[i].type&&$('input[name="'+field_data[i].name+'"]').daterangepicker({locale:{format:field_data[i].format}})}function onclik_submit(){$(".for_modal #button-submit").on("click",function(a){var t=generate_form_data("#form-"+the_data.data.id);return $.ajax({type:"POST",url:the_data.data.target,data:t,cache:!1,contentType:!1,processData:!1,success:function(a){var t=!1;void 0===the_data.data.reload||null==the_data.data.reload?t=!1:1==the_data.data.reload&&(t=!0),$("#"+the_data.data.id).modal("hide"),from_filter(!1),get_data(JSON.parse(a)),$("#form-"+the_data.data.id).trigger("reset"),1==t&&initiation(targeturl)}}),!1})}function generate_form_data(a){console.log("generate from data from field");var t=$(a).find("[name]"),e=new FormData;return $(t).each(function(a,t){$(this).is(":checkbox")?$(this).is(":checked")?e.append(t.name,t.value):e.append(t.name,"off"):$(this).is(":radio")?$(this).is(":checked")&&e.append(t.name,t.value):$(this).is(":file")?e.append(t.name,$(this).prop("files")[0]):e.append(t.name,t.value)}),e}function generate_json_from_field(a){console.log("generate json from field form");var e=$(a).find("[name]"),l="{",d=0;return $(e).each(function(a,t){$(this).is(":checkbox")?($(this).is(":checked")?(l+='"'+t.name+'"',l+=":",l+='"'+t.value+'"'):(l+='"'+t.name+'"',l+=":",l+='"off"'),d!=e.length-1&&(l+=",")):$(this).is(":radio")?$(this).is(":checked")&&(l+='"'+t.name+'"',l+=":",l+='"'+t.value+'"',d!=e.length-1&&(l+=",")):(l+='"'+t.name+'"',l+=":",l+='"'+t.value+'"',d!=e.length-1&&(l+=",")),d++}),l+="}"}function generate_form(a){console.log("Generate form for frond end"),field_data=1==a?the_data.data.filters:the_data.data.fields;var t,e="";for(t=0;t<field_data.length;t++)"hidden"==field_data[t].type?e+=set_field_form(field_data[t]):("label"==field_data[t].type?(1==field_data[t].classes.includes("full-width")?e+='<div class="form-group col-md-12 col-sm-12 col-xs-12">':e+='<div class="form-group col-md-6 col-sm-6 col-xs-12">',e+="<label><h5>"+field_data[t].label+"<h5></label>",e+='<hr style="margin-bottom: 0px !important">'):"separation"==field_data[t].type?(1==field_data[t].classes.includes("full-width")?e+='<div class="col-md-12 col-sm-12 col-xs-12">':e+='<div class="col-md-6 col-sm-6 col-xs-12">',e+="<hr>"):(1==field_data[t].classes.includes("full-width")?e+='<div class="form-group '+hidding_field(field_data[t].classes)+' col-md-12 col-sm-12 col-xs-12">':e+='<div class="form-group '+hidding_field(field_data[t].classes)+' col-md-6 col-sm-6 col-xs-12">',e+="<label>"+field_data[t].label+"</label>",e+=set_field_form(field_data[t])),e+="</div>");return e+='<div class="clearfix"></div>'}function set_field_form(a){var t="";if("text"==a.type)t+='<input type="text" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes,a.name),t+=">";else if("email"==a.type)t+='<input type="email" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes,a.name),t+=">";else if("password"==a.type)t+='<input type="password" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes),t+=">";else if("date"==a.type)t+='<input type="date" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes,a.name),t+=">";else if("textarea"==a.type)t+='<textarea name="'+a.name+'" id="'+a.name+'" class="form-control" rows="4" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes),t+=">"+a.value+"</textarea>";else if("hidden"==a.type)t+='<input type="hidden" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" ',t+=field_classes(a.classes),t+="></textarea>";else if("select"==a.type){for(t+='<select name="'+a.name+'" id="'+a.name+'" class="form-control custom-select" ',t+=field_classes(a.classes),t+=">",""==a.placeholder||(t+='<option value="">'+a.placeholder+"</option>"),e=0;e<a.options.length;e++)a.value==a.options[e].value?t+='<option value="'+a.options[e].value+'" selected>'+a.options[e].label+"</option>":t+='<option value="'+a.options[e].value+'">'+a.options[e].label+"</option>";t+="</select>"}else if("radio"==a.type){for(e=0;e<a.options.length;e++)t+='<div class="form-check">',t+='<input class="form-check-input" type="radio" name="'+a.name+'" id="'+a.name+e+'" value="'+a.options[e].value+'" ',a.value==a.options[e].value?t+="checked>":t+=">",t+='<label class="form-check-label" for="'+a.name+e+'">',t+=a.options[e].label,t+="</label>",t+="</div>"}else if("checkbox"==a.type){var e;for(e=0;e<a.options.length;e++)t+='<div class="form-check">',t+='<input class="form-check-input" type="checkbox" name="'+a.name+'" id="'+a.name+e+'" ',"on"==a.value?t+="checked>":t+=">",t+='<label class="form-check-label" for="'+a.name+e+'">',t+=a.options[e].label,t+="</label>",t+="</div>"}else"file"==a.type?(t+='<input type="file" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" placeholder="'+a.placeholder+'" ',t+=field_classes(a.classes,a.name),t+=">"):"daterange"==a.type?(t+='<input type="text" name="'+a.name+'" id="'+a.name+'" value="'+a.value+'" class="form-control" ',t+=field_classes(a.classes,a.name),t+=" />"):"info"==a.type&&(t+='<div class="">'+a.value+"</div>");return t}function field_classes(a,l){var t="",e="",d="";(1==a.includes("required")&&(t="required"),1==a.includes("readonly")&&(e="readonly"),1==a.includes("disabled")&&(d="disabled"),1==a.includes("active-when-"))&&($('[name="'+l+'"]').addClass("hidding"),console.log("true"),a.split(" ").forEach(function(a){if(a.includes("active-when-")){var t,e=a.substr(12).split("-");for(t=0;t<field_data.length;t++)field_data[t].name==e[0]&&(console.log(field_data[t].name),change_select(e,l))}}));return t+" "+e+" "+d}function hidding_field(a){return 1==a.includes("active-when-")?"hidding":""}function change_select(a,t){$(document).on("change",'[name="'+a[0]+'"]',function(){$(this).val()==a[1]?(console.log("sama"),$('[name="'+t+'"]').parent().removeClass("hidding"),$('[name="'+t+'"]').parent().addClass("displayed")):($('[name="'+t+'"]').parent().removeClass("displayed"),$('[name="'+t+'"]').parent().addClass("hidding"))})}function hide_toolbar(){if(console.log("show or hide toolbar button"),1==the_data.data.insertable?$(".button-add").show():$(".button-add").hide(),1==the_data.data.pdf?$(".button-pdf").show():$(".button-pdf").hide(),1==the_data.data.xls?$(".button-xls").show():$(".button-xls").hide(),null!=the_data.data.filters?$(".button-filter").show():$(".button-filter").hide(),null!=the_data.data.toolbars){var a,t="";for(a=0;a<the_data.data.toolbars.length;a++)t+='<div class="button-toolbar-item '+the_data.data.toolbars[a].class+'">',t+='<a href="javascript:void(0)" onclick="show_modal(\''+the_data.data.toolbars[a].target+"')\">",t+='<i style="font-size: 16px;" class="fa fa-'+the_data.data.toolbars[a].icon+'"></i><br>'+the_data.data.toolbars[a].label,t+="</a>",t+="</div>";$(".top_toolbar .toolbar-right .for_toolbars").html(t)}}function show_modal(a){return $.ajax({type:"POST",url:a,dataType:"JSON",success:function(a){get_data(a)}}),!0}function generate_modal(){var a="";return a+='<div class="modal" id="'+the_data.data.id+'" role="dialog">',a+='<form id="form-'+the_data.data.id+'" enctype="multipart/form-data" method="post">',a+='<div class="modal-dialog modal-lg">',a+="\x3c!-- Modal content--\x3e",a+='<div class="modal-content">',a+='<div class="modal-header">',a+='<button type="button" class="close" data-dismiss="modal">&times;</button>',a+='<h4 class="modal-title">'+the_data.data.title+"</h4>",a+="</div>",a+='<div class="modal-body">',a+="</div>",a+='<div class="modal-footer">',a+="</div>",a+="</div>",a+="</div>",a+="</form>",a+="</div>"}function generate_table(){console.log("generate table start");var a="";return a+='<div class="table-responsive">',a+='<table class="table'+table_classes(the_data.data.classes)+'">',a+="<thead>",a+=set_table_header(),a+="</thead>",a+="<tbody>",a+=set_table_body(),a+="</tbody>",a+="</table>",a+="</div>",console.log("generate table finished"),a}function set_table_header(){console.log("set table header");var a,t,e="";for(a=0;a<the_data.data.header.length;a++){for(e+="<tr>",t=0;t<the_data.data.header[a].length;t++)e+='<td class="align-middle '+text_classes(the_data.data.header[a][t].classes)+'" ',null!=the_data.data.header[a][t].rowspan&&(e+='rowspan="'+the_data.data.header[a][t].rowspan+'" '),null!=the_data.data.header[a][t].colspan&&(e+='colspan="'+the_data.data.header[a][t].colspan+'" '),e+=">",e+=the_data.data.header[a][t].value,e+="</td>";1!=the_data.data.editable&&1!=the_data.data.deletable&&1!=the_data.data.statusable&&1!=the_data.data.detailable||0==a&&(e+='<td class="align-middle text-center font-weight-bold" rowspan="'+the_data.data.header.length+'" colspan="4">Action',e+="</td>"),e+="</tr>"}return e}function set_table_body(){console.log("set table body");var a,t,e="";for(a=0;a<the_data.data.body.length;a++){for(e+="<tr>",t=0;t<the_data.data.body[a].length;t++)1==the_data.data.body[a][t].classes.includes("hidden")||(e+='<td class="'+text_classes(the_data.data.body[a][t].classes)+'"',null!=the_data.data.body[a][t].rowspan&&(e+='rowspan="'+the_data.data.body[a][t].rowspan+'" '),null!=the_data.data.body[a][t].colspan&&(e+='colspan="'+the_data.data.body[a][t].colspan+'" '),e+=">",e+=the_data.data.body[a][t].value,e+="</td>");1==the_data.data.body.length&1==the_data.data.body[a][0].classes.includes("empty")||(1==the_data.data.statusable&&(e+='<td class="text-center font-weight-bold">',e+='<a class="item-status" id="'+the_data.data.body[a][0].value+'" href="javascript:void(0);" title="edit status"><i style="font-size: 16px;" class="fa fa-check"></i></a>',e+="</td>"),1==the_data.data.editable&&(e+='<td class="text-center font-weight-bold">',e+='<a class="item-edit" id="'+the_data.data.body[a][0].value+'" href="javascript:void(0);" title="edit"><i style="font-size: 16px;" class="fas fa-edit"></i></a>',e+="</td>"),1==the_data.data.deletable&&(e+='<td class="text-center font-weight-bold">',e+='<a class="item-delete" id="'+the_data.data.body[a][0].value+'" href="javascript:void(0);" title="delete"><i style="font-size: 16px;" class="fas fa-trash"></i></a>',e+="</td>"),1==the_data.data.detailable&&(e+='<td class="text-center font-weight-bold">',e+='<a class="item-detail" id="'+the_data.data.body[a][0].value+'" href="javascript:void(0);" title="detail"><i style="font-size: 16px;" class="fas fa-info"></i></a>',e+="</td>")),e+="</tr>"}return e}function table_classes(a){var t="";return 1==a.includes("striped")&&(t+=" table-striped"),1==a.includes("bordered")&&(t+=" table-bordered"),1==a.includes("hover")&&(t+=" table-hover"),t}function text_classes(a){return(1==a.includes("bold")?"font-weight-bold":1==a.includes("light")?"font-weight-light":(a.includes("normal"),"font-weight-normal"))+" "+(1==a.includes("italic")?"font-italic":"")+" "+(1==a.includes("uppercase")?"text-uppercase":1==a.includes("lowercase")?"text-lowercase":1==a.includes("capitalize")?"text-capitalize":"")+" "+(1==a.includes("align-left")?"text-left":1==a.includes("align-center")?"text-center":1==a.includes("align-right")?"text-right":"text-left")}$(".button-add").on("click",function(){return $.ajax({type:"POST",url:targeturl+"/insert",dataType:"JSON",success:function(a){get_data(a)}}),!0}),$("#button-save").on("click",function(a){var t=generate_form_data("#form-add");return console.log(t),$.ajax({type:"POST",url:targeturl+"/insert",data:t,cache:!1,contentType:!1,processData:!1,success:function(a){$("#modal-add").modal("hide"),from_filter(!1),get_data(JSON.parse(a)),$("#form-add").trigger("reset"),initiation(targeturl)}}),!1}),$("#show-data").on("click",".item-edit",function(){var a=$(this).attr("id");return $.ajax({type:"POST",url:targeturl+"/update",dataType:"JSON",data:{id:a},success:function(a){get_data(a)}}),!0}),$("#button-update").on("click",function(a){var t=generate_form_data("#form-edit");return $.ajax({type:"POST",url:targeturl+"/update",data:t,cache:!1,contentType:!1,processData:!1,success:function(a){$("#modal-edit").modal("hide"),from_filter(!1),get_data(JSON.parse(a)),initiation(targeturl)}}),!1}),$("#button-submit-filter").on("click",function(){var a=generate_json_from_field("#form-filter");return $.ajax({type:"POST",url:targeturl+"/list",dataType:"JSON",data:JSON.parse(a),success:function(a){from_filter(!0),get_data(a),$("body").toggleClass("full-width semi-width")}}),!1}),$("#show-data").on("click",".item-delete",function(){var a=$(this).attr("id");$("#modal-delete").modal("show"),$('[name="id"]').val(a)}),$("#button-delete").on("click",function(){var a=$("#id").val();return $.ajax({type:"POST",url:targeturl+"/delete",dataType:"JSON",data:{id:a},success:function(a){$("#modal-delete").modal("hide"),from_filter(!1),get_data(a),initiation(targeturl)}}),!0}),$("#show-data").on("click",".item-status",function(){var a=$(this).attr("id");return $.ajax({type:"POST",url:targeturl+"/update_status",dataType:"JSON",data:{id:a},success:function(a){from_filter(!1),get_data(a),initiation(targeturl)}}),!0}),$("#show-data").on("click",".item-detail",function(){var a=$(this).attr("id");return $.ajax({type:"POST",url:targeturl+"/detail",dataType:"JSON",data:{id:a},success:function(a){get_data(a)}}),!0}),$(".paging").on("click","a.page-link",function(){var a=($(this).attr("numb")-1)*globallimit;if(0==fromfilter){var t="{";t+='"offset":'+a+",",t+='"submit":"sumbit"',t+="}"}else{(t=generate_json_from_field("#form-filter")).length,t=t.slice(0,t.length-1),t+=',"offset":"'+a+'"}'}return $.ajax({type:"POST",url:targeturl+"/list",dataType:"JSON",data:JSON.parse(t),success:function(a){get_data(a)}}),!1});